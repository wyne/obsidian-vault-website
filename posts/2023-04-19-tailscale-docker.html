<!doctype html><html><head><title>2023-04-19 Tailscale Docker</title><base href="../"><meta id="root-path" root-path="../"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes,minimum-scale=1,maximum-scale=5"><meta charset="UTF-8"><link rel="icon" href="lib/media/favicon.png"><script src="lib/scripts/graph-data.js"></script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="stylesheet" href="lib/styles/other-plugins.css"><link rel="stylesheet" href="lib/styles/snippets.css"><link rel="stylesheet" href="lib/styles/global-variable-styles.css"><link rel="stylesheet" href="lib/styles/plugin-styles.css"><script src="lib/scripts/pixi.js"></script><script src="lib/scripts/tinycolor.js"></script><script type="module" src="lib/scripts/graph-view.js"></script><script src="lib/scripts/graph-wasm.js"></script><script src="lib/scripts/graph-render-worker.js"></script><script src="lib/scripts/webpage.js"></script><include src="lib/html/custom-head-content.html"></include></head><body class="theme-dark loading"><div class="webpage-container"><div class="sidebar-left sidebar"><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><include src="lib/html/file-tree.html"></include></div></div></div></div><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div></div><div class="document-container show"><div class="markdown-preview-view markdown-rendered allow-fold-headings"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="markdown-preview-pusher" style="height:.1px;margin-bottom:0;width:1px"></div><div class="mod-header"></div><div><pre class="frontmatter language-yaml" style="display:none" tabindex="0"><code class="language-yaml is-loaded"><span class="token key atrule">published</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><button class="copy-code-button">Copy</button></pre></div><div><div class="block-language-dataviewjs node-insert-event"><span><span><h1 data-heading="JustinWyne.com" id="JustinWyne.com">JustinWyne.com</h1><div class="block-language-dataviewjs node-insert-event"><span><span><a data-tooltip-position="top" aria-label="Home.md" data-href="Home.md" href="home.html" class="internal-link" target="_self" rel="noopener">Home</a> | <a data-tooltip-position="top" aria-label="About.md" data-href="About.md" href="about.html" class="internal-link" target="_self" rel="noopener">About</a> | <a data-tooltip-position="top" aria-label="Photos/Photos.md" data-href="Photos/Photos.md" href="photos/photos.html" class="internal-link" target="_self" rel="noopener">Photos</a> | <a data-tooltip-position="top" aria-label="Posts/Posts.md" data-href="Posts/Posts.md" href="posts/posts.html" class="internal-link" target="_self" rel="noopener">Posts</a></span></span></div><hr></span></span></div></div><div class="heading-wrapper"><h1 data-heading="How to use Tailscale for Docker Containers on Synology" class="heading" id="How_to_use_Tailscale_for_Docker_Containers_on_Synology"><div class="heading-before"></div>How to use Tailscale for Docker Containers on Synology<div class="heading-after">...</div></h1><div class="heading-children"><div><p><em>Complete with reverse-proxy subdomains</em></p></div><div><p>I have a few docker containers running on my Synology NAS at home for streaming live TV from Plex, Home Assistant for home automation, and others. And I’ve been using Wireguard running on my Firewalla to access the network and connect to those services for the past year.</p></div><div><p>However, I’ve had a lot of trouble with Wireguard connecting or staying connected from the Mac and iOS apps. Often times I would toggle the VPN on and it says it’s connected, but nothing works. Checking the logs reveal that the handshake never went through and I would have to try a few more times before I’m finally able to connect.</p></div><div><p>This week I’ve been playing with Tailscale, and it has solved my biggest pains with Wireguard. Specifically, it allows me to:</p></div><div><ul><li data-line="0">Use the same domains to access my machines on the network from within and beyond my home network</li><li data-line="1">Always stay connected</li><li data-line="2">Have more granular access control in case I want to share access with others</li></ul></div><div class="heading-wrapper"><h2 data-heading="Enter Tailscale" class="heading" id="Enter_Tailscale"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Enter Tailscale<div class="heading-after">...</div></h2><div class="heading-children"><div><p>Tailscale itself is easy enough to set up.</p></div><div><ul><li data-line="0">Install the client on phones and computers</li><li data-line="1">Install the package from Synology</li></ul></div><div><p>And everything basically works. One additional step I took is to allow for my NAS to be an exit node, which will allow me to forward all of my traffic from my connect device through my home network. You can then enable/disable this from each client as needed. To do that, ssh into your NAS and run:</p></div><div><pre><code>$ sudo tailscale up --advertise-routes=192.168.0.0/24 --advertise-exit-node
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Adjusting <code>192.168.0.0</code> to be your subnet. And this will even persist between restarts of your NAS, so you won’t have to run it again.</p></div><div><p>With that, you should now be able to connect to each of your devices by copying the IP Address from the Tailscale app.</p></div><div><p>You can also refer to each device by name if you enable MagicDNS within the Tailscale console.</p></div><div><p><img alt="Screenshot+2023-04-19+at+5.34.38+PM.png" src="https://images.squarespace-cdn.com/content/v1/5a8687cad74cff1e0c22bf3b/0d4cdc4c-a773-4f1f-933f-90374ad33a06/Screenshot+2023-04-19+at+5.34.38+PM.png" referrerpolicy="no-referrer" style="width:478px;max-width:100%"></p></div><div><p>However, you’ll run into a problem if you utilize the Synology Reverse Proxy settings to give each of your docker containers subdomains to avoid having to type in port numbers.</p></div><div><p>MagicDNS does not allow you to configure subdomains. It will only route based on one short name of the device. So if you want multiple subdomains to all route to your NAS for a reverse proxy, you’ll need something else.</p></div></div></div><div class="heading-wrapper"><h2 data-heading="Reverse proxy subdomains for Docker containers" class="heading" id="Reverse_proxy_subdomains_for_Docker_containers"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Reverse proxy subdomains for Docker containers<div class="heading-after">...</div></h2><div class="heading-children"><div><p><img src="https://images.squarespace-cdn.com/content/v1/5a8687cad74cff1e0c22bf3b/8a8df52d-d9c8-4ab0-b2a9-ce96a3d45864/dns.jpg" referrerpolicy="no-referrer"></p></div><div><p>I found that using the built in Synology DNS Server solves this quite well. I can serve DNS for all NAS subdomains and point them to the Tailscale IP of your Synology. Then the already configured reverse proxy will handle the rest.</p></div><div><p>Using a wildcard (*) A record should be sufficient for redirecting all subdomains to you NAS.</p></div><div><p><img src="https://images.squarespace-cdn.com/content/v1/5a8687cad74cff1e0c22bf3b/e06b7096-2c18-4a4a-a8ff-a0914d52596a/Screenshot+2023-04-19+at+6.01.19+PM.png" referrerpolicy="no-referrer"></p></div><div><p>Next, we’ll need to route all requests for your TLD to the Synology DNS server. Configure this via the Tailscale Admin Console.</p></div><div><p>This is telling Tailscale to route anything on the <code>home</code> top level domain to use the DNS on the Synology that we just set up.</p></div><div><p>I make this the same as the search domain on my internal network</p></div><div><p>Now I can use the same domain names inside and outside of my home network</p></div><div><p><strong>Inside the home network</strong></p></div><div><pre><code>*.nas.home
&gt; (DNS) Firewalla  
&gt; 192.168.x.x Local Synology IP  
&gt; Synology Reverse Proxy  
&gt; 192.168.x.x:&lt;port&gt; on Synology IP
</code><button class="copy-code-button">Copy</button></pre></div><div><p><strong>Outside the home network</strong></p></div><div><pre><code>*.nas.home
&gt; (DNS) Synology DNS  
&gt; 100.x.x.x Tailscale Synology IP  
&gt; Synology Reverse Proxy  
&gt; 192.168.x.x:&lt;port&gt; on Synology IP
</code><button class="copy-code-button">Copy</button></pre></div><div class="mod-footer"></div><h1 data-heading="2023-04-19 Tailscale Docker" id="2023-04-19_Tailscale_Docker"></h1></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder"><div class="graph-view-container"><div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div><canvas id="graph-canvas" width="512px" height="512px"></canvas></div></div></div><div class="tree-container outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area"><div class="tree-item" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="#How_to_use_Tailscale_for_Docker_Containers_on_Synology"><span class="tree-item-title"><p>How to use Tailscale for Docker Containers on Synology</p></span></a></div><div class="tree-item-children"><div class="tree-item" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="#Enter_Tailscale"><span class="tree-item-title"><p>Enter Tailscale</p></span></a></div><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="#Reverse_proxy_subdomains_for_Docker_containers"><span class="tree-item-title"><p>Reverse proxy subdomains for Docker containers</p></span></a></div><div class="tree-item-children"></div></div></div></div></div></div></div></div></div></div></div></div></body></html>